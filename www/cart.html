---
layout: default
title: Login
container_class: col-xl-5 col-lg-6 col-sm-8 d-flex flex-column justify-content-center flex-grow-1 mt-2
---

<img class="col-8 col-lg-5 col-md-6 d-flex align-self-center" src="/cdn/img/cart.svg">

<!--Modal: modalPush-->
<div class="modal-dialog modal-notify modal-info" role="document">
    <!--Content-->
    <div class="modal-content text-center">

        <!--Body-->
        <div class="modal-body">
            <form class="text-center border border-light p-3" action="#!">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Product name</th>
                            <th>Price</th>
                            <!-- <th>Remove</th> -->
                        </tr>
                    </thead>
                    <tbody id="table"></tbody>
                </table>
            </form>

            <button id="check_out" class="btn btn-secondary btn-block mb-4" type="submit">Check out</button>
        </div>
    </div>
    <!--/.Content-->
</div>
<!--Modal: modalPush-->

<script>
    (async () => {
        let token = localStorage.getItem('loginToken');
        let res = await $.post('{{ site.api }}/cart', { token });
        console.log(res);
        if (!res || !res.data) console.error('error');
        else if (res.error) alert(res.error);
        else if (!res.data.length) {
            // nothing in cart
            console.log('nothing in cart')
        } else {
            // something in cart
            let items = res.data;
            let subtotal = 0;
            items.map(item => {
                let price = item.price * item.quantity;
                if (item.toppings) {
                    for (let topping of item.toppings)
                        price += topping.price
                }

                item.price = price;
                subtotal += price;

                $('#table').append(`<tr>
                    <th scope="row">1</th>
                    <td>${item.name}</td>
                    <td>${item.price}</td>
                    <!--<td><a href="#" style="color: black"><i class="fas fa-times"></i></a></td>-->
                </tr>`);
                    
            });
            console.log(items);
        }
    })();

    document.querySelector('#check_out').addEventListener('click', e => {
        e.preventDefault();
        window.location.href = '/';
    });
</script>
